"""
Easy Instagram Automation Service MCP Server

‰ΩøÁî® FastMCP ÁöÑ from_openapi ÊñπÊ≥ïËá™Âä®ÁîüÊàê

Version: 1.0.0
Transport: stdio
"""
import os
import json
import httpx
from fastmcp import FastMCP

# ÊúçÂä°Âô®ÁâàÊú¨ÂíåÈÖçÁΩÆ
__version__ = "1.0.0"
__tag__ = "easy_instagram_automation_service/1.0.0"

# API ÈÖçÁΩÆ
API_KEY = os.getenv("API_KEY", "")

# ‰º†ËæìÂçèËÆÆÈÖçÁΩÆ
TRANSPORT = "stdio"


# OpenAPI ËßÑËåÉ
OPENAPI_SPEC = """{\n  \"openapi\": \"3.0.0\",\n  \"info\": {\n    \"title\": \"Easy Instagram Automation Service\",\n    \"version\": \"1.0.0\",\n    \"description\": \"RapidAPI: socialgreatnessfactor/easy-instagram-automation-service\"\n  },\n  \"servers\": [\n    {\n      \"url\": \"https://easy-instagram-automation-service.p.rapidapi.com\"\n    }\n  ],\n  \"paths\": {\n    \"/auth/auth_login_auth_login_post\": {\n      \"post\": {\n        \"summary\": \"Auth login\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Auth login\",\n        \"operationId\": \"auth_login\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/auth/timeline_feed_auth_timeline_feed_get\": {\n      \"get\": {\n        \"summary\": \"timeline feed\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - timeline feed\",\n        \"operationId\": \"timeline_feed\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/insights/media_insights_media_post\": {\n      \"post\": {\n        \"summary\": \"media insights\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Get insights data for media\",\n        \"operationId\": \"media_insights\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/insights/account_insights_account_post\": {\n      \"post\": {\n        \"summary\": \"account insights\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Get insights for account\",\n        \"operationId\": \"account_insights\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/insights/media_feed_all_insights_media_feed_all_post\": {\n      \"post\": {\n        \"summary\": \"media feed all\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Return media with insights\",\n        \"operationId\": \"media_feed_all\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/story/story_pk_from_url_story_pk_from_url_get\": {\n      \"get\": {\n        \"summary\": \"Story from URL\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Get Story (media) PK from URL\",\n        \"operationId\": \"story_from_url\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/igtv/igtv_upload_igtv_upload_by_url_post\": {\n      \"post\": {\n        \"summary\": \"IGTV upload by url_copy\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Upload photo by URL and configure to feed\",\n        \"operationId\": \"igtv_upload_by_url_copy\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/igtv/igtv_download_by_url_igtv_download_by_url_post\": {\n      \"post\": {\n        \"summary\": \"IGTV download by url\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Download IGTV video using URL\",\n        \"operationId\": \"igtv_download_by_url\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/user/user_remove_follower_user_remove_follower_post\": {\n      \"post\": {\n        \"summary\": \"user remove follower\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Remove a follower\",\n        \"operationId\": \"user_remove_follower\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/user/username_from_user_id_user_username_from_id_post\": {\n      \"post\": {\n        \"summary\": \"username from user id\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Get username from user id\",\n        \"operationId\": \"username_from_user_id\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/user/user_id_from_username_user_id_from_username_post\": {\n      \"post\": {\n        \"summary\": \"user id from username\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Get user id from username\",\n        \"operationId\": \"user_id_from_username\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/user/user_unfollow_user_unfollow_post\": {\n      \"post\": {\n        \"summary\": \"user unfollow\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Unfollow a user\",\n        \"operationId\": \"user_unfollow\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/user/user_follow_user_follow_post\": {\n      \"post\": {\n        \"summary\": \"user follow\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Follow a user\",\n        \"operationId\": \"user_follow\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/user/user_info_by_username_user_info_by_username_post\": {\n      \"post\": {\n        \"summary\": \"user info by username\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Get user object from username\",\n        \"operationId\": \"user_info_by_username\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/user/user_info_user_info_post\": {\n      \"post\": {\n        \"summary\": \"user info\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Get user object from user id\",\n        \"operationId\": \"user_info\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/user/user_following_user_following_post\": {\n      \"post\": {\n        \"summary\": \"user following\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Get user's followers information\",\n        \"operationId\": \"user_following\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/user/user_followers_user_followers_post\": {\n      \"post\": {\n        \"summary\": \"user followers\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Get user's followers\",\n        \"operationId\": \"user_followers\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/photo/photo_upload_photo_upload_by_url_post\": {\n      \"post\": {\n        \"summary\": \"photo upload by url\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - photo upload by url\",\n        \"operationId\": \"photo_upload_by_url\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/photo/photo_download_by_url_photo_download_by_url_post\": {\n      \"post\": {\n        \"summary\": \"photo download by url\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - photo download by url\",\n        \"operationId\": \"photo_download_by_url\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/photo/photo_upload_to_story_by_url_photo_upload_to_story_by_url_post\": {\n      \"post\": {\n        \"summary\": \"photo upload to story by url\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - photo upload to story by url\",\n        \"operationId\": \"photo_upload_to_story_by_url\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/video/video_upload_video_upload_by_url_post\": {\n      \"post\": {\n        \"summary\": \"video upload by url\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - video upload by url\",\n        \"operationId\": \"video_upload_by_url\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/video/video_download_by_url_video_download_by_url_post\": {\n      \"post\": {\n        \"summary\": \"video download by url\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - video download by url\",\n        \"operationId\": \"video_download_by_url\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/video/video_download_video_download_post\": {\n      \"post\": {\n        \"summary\": \"video download\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - video download\",\n        \"operationId\": \"video_download\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/video/video_upload_to_story_by_url_video_upload_to_story_by_url_post\": {\n      \"post\": {\n        \"summary\": \"video upload to story by url\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - video upload to story by url\",\n        \"operationId\": \"video_upload_to_story_by_url\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/video/video_upload_to_story_video_upload_to_story_post\": {\n      \"post\": {\n        \"summary\": \"video upload to story\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - video upload to story\",\n        \"operationId\": \"video_upload_to_story\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/media/media_likers_media_likers_post\": {\n      \"post\": {\n        \"summary\": \"media likers\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - media likers\",\n        \"operationId\": \"media_likers\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/media/media_unlike_media_unlike_post\": {\n      \"post\": {\n        \"summary\": \"media unlike\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - media unlike\",\n        \"operationId\": \"media_unlike\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/media/media_like_media_like_post\": {\n      \"post\": {\n        \"summary\": \"like media\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - like media\",\n        \"operationId\": \"like_media\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/media/media_oembed_media_oembed_post\": {\n      \"post\": {\n        \"summary\": \"media oembed\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - media oembed\",\n        \"operationId\": \"media_oembed\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/media/user_medias_media_user_medias_post\": {\n      \"post\": {\n        \"summary\": \"user media\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - user media\",\n        \"operationId\": \"user_media\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/media/media_info_media_info_post\": {\n      \"post\": {\n        \"summary\": \"media info\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - media info\",\n        \"operationId\": \"media_info\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/auth/auth_relogin_auth_relogin_post\": {\n      \"post\": {\n        \"summary\": \"Auth relogin\",\n        \"description\": \"This endpoint will return back all information for use of instagram automation - Auth relogin\",\n        \"operationId\": \"auth_relogin\",\n        \"parameters\": [],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {}\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \"components\": {\n    \"securitySchemes\": {\n      \"ApiAuth\": {\n        \"type\": \"apiKey\",\n        \"in\": \"header\",\n        \"name\": \"X-RapidAPI-Key\"\n      }\n    }\n  },\n  \"security\": [\n    {\n      \"ApiAuth\": []\n    }\n  ]\n}"""

# ÂàõÂª∫ HTTP ÂÆ¢Êà∑Á´Ø
# ËÆæÁΩÆÈªòËÆ§ headers
default_headers = {}


# RapidAPI ÂøÖÈúÄÁöÑ headers
if API_KEY:
    default_headers["X-RapidAPI-Key"] = API_KEY
    default_headers["X-RapidAPI-Host"] = "easy-instagram-automation-service.p.rapidapi.com"
else:
    print("‚ö†Ô∏è  Ë≠¶Âëä: Êú™ËÆæÁΩÆ API_KEY ÁéØÂ¢ÉÂèòÈáè")
    print("   RapidAPI ÈúÄË¶Å API Key ÊâçËÉΩÊ≠£Â∏∏Â∑•‰Ωú")
    print("   ËØ∑ËÆæÁΩÆ: export API_KEY=‰Ω†ÁöÑRapidAPI-Key")

# ÂØπ‰∫é POST/PUT/PATCH ËØ∑Ê±ÇÔºåËá™Âä®Ê∑ªÂä† Content-Type
default_headers["Content-Type"] = "application/json"




client = httpx.AsyncClient(
    base_url="https://easy-instagram-automation-service.p.rapidapi.com", 
    timeout=30.0
)


# ‰ªé OpenAPI ËßÑËåÉÂàõÂª∫ FastMCP ÊúçÂä°Âô®
openapi_dict = json.loads(OPENAPI_SPEC)
mcp = FastMCP.from_openapi(
    openapi_spec=openapi_dict,
    client=client,
    name="easy_instagram_automation_service",
    version=__version__
)


# Ê≥®ÂÜåËØ∑Ê±ÇÊã¶Êà™Âô®Ôºå‰∏∫ÊâÄÊúâËØ∑Ê±ÇÊ∑ªÂä† RapidAPI headers
_original_request = client.request

async def _add_rapidapi_headers(method, url, **kwargs):
    """Êã¶Êà™ÊâÄÊúâËØ∑Ê±ÇÔºåÊ∑ªÂä†ÂøÖÈúÄÁöÑ RapidAPI headers"""
    # Á°Æ‰øù headers Â≠òÂú®
    if 'headers' not in kwargs:
        kwargs['headers'] = {}
    
    # Ê∑ªÂä† RapidAPI ÂøÖÈúÄÁöÑ headers
    if API_KEY:
        kwargs['headers']['X-RapidAPI-Key'] = API_KEY
        kwargs['headers']['X-RapidAPI-Host'] = "easy-instagram-automation-service.p.rapidapi.com"
    else:
        print("‚ö†Ô∏è  Ë≠¶Âëä: API_KEY Êú™ËÆæÁΩÆÔºåËØ∑Ê±ÇÂèØËÉΩÂ§±Ë¥•")
    
    # ÂØπ‰∫é POST/PUT/PATCHÔºåÊ∑ªÂä† Content-Type
    if method.upper() in ['POST', 'PUT', 'PATCH']:
        if 'Content-Type' not in kwargs['headers']:
            kwargs['headers']['Content-Type'] = 'application/json'
    
    return await _original_request(method, url, **kwargs)

# ÊõøÊç¢ request ÊñπÊ≥ï
client.request = _add_rapidapi_headers


def main():
    """‰∏ªÂÖ•Âè£ÁÇπ"""
    print(f"üöÄ ÂêØÂä® Easy Instagram Automation Service MCP ÊúçÂä°Âô®")
    print(f"üì¶ ÁâàÊú¨: {__tag__}")
    print(f"üîß ‰º†ËæìÂçèËÆÆ: {TRANSPORT}")
    
    print()
    
    # ËøêË°åÊúçÂä°Âô®
    
    mcp.run(transport="stdio")
    


if __name__ == "__main__":
    main()